# 응답 속도 개선 방안

## 현재 병목 지점 분석

### 1. 순차적 API 호출
- **관련 질문**: 관련성 체크 → 응답 생성 (2번의 순차 API 호출)
- **무관한 질문**: 관련성 체크 → 거절 메시지 생성 (2번의 순차 API 호출)

### 2. 느린 모델 사용
- 응답 생성: `gemini-2.5-pro` (느림, 고품질)
- 관련성 체크: `gemini-2.5-flash` (빠름)

### 3. 긴 프롬프트
- 프로필 데이터 전체를 프롬프트에 포함
- 긴 대화 기록 포함

## 개선 방안

### 방안 1: 관련성 체크 최적화 (즉시 적용 가능) ⭐ 추천

**개선점**:
- 관련 질문일 때는 관련성 체크를 생략하고 바로 응답 생성
- 무관한 질문일 때만 관련성 체크 수행

**예상 효과**: 관련 질문 응답 시간 50% 단축

### 방안 2: 빠른 휴리스틱 필터 추가

**개선점**:
- 명백히 무관한 질문은 로컬 휴리스틱으로 빠르게 필터링
- 애매한 경우만 Gemini API 호출

**예상 효과**: 무관한 질문 처리 시간 70% 단축

### 방안 3: 모델 변경

**개선점**:
- 응답 생성: `gemini-2.5-pro` → `gemini-2.5-flash`
- 품질은 약간 떨어지지만 속도는 2-3배 향상

**예상 효과**: 응답 생성 시간 60-70% 단축

### 방안 4: 프롬프트 최적화

**개선점**:
- 프로필 데이터 요약/압축
- 대화 기록 최적화 (최근 5개만)

**예상 효과**: 토큰 수 감소로 API 응답 시간 20-30% 단축

### 방안 5: 병렬 처리

**개선점**:
- 관련성 체크와 응답 생성을 병렬로 시작
- 관련성 체크가 무관하다고 판단하면 응답 생성 취소

**예상 효과**: 관련 질문 응답 시간 30-40% 단축

## 우선순위별 구현 계획

### Phase 1: 즉시 적용 (가장 효과적)
1. ✅ 관련 질문일 때 관련성 체크 생략
2. ✅ 빠른 휴리스틱 필터 추가
3. ✅ 모델 변경 (gemini-2.5-pro → gemini-2.5-flash)

### Phase 2: 추가 최적화
4. 프롬프트 최적화
5. 병렬 처리 구현

## 예상 성능 개선

| 시나리오 | 현재 | Phase 1 후 | 개선율 |
|---------|------|-----------|--------|
| 관련 질문 | ~3-5초 | ~1-2초 | 60-70% |
| 무관한 질문 | ~2-3초 | ~0.5-1초 | 70-80% |

